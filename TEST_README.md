# MCP Server テストスクリプト

このディレクトリには、MCPサーバーをテストするための3つのスクリプトが含まれています。

## 📁 ファイル一覧

- `app.py` - MCPサーバーのメインアプリケーション
- `test_mcp_server.sh` - 自動テストスクリプト（Bash）
- `interactive_test.sh` - インタラクティブテストスクリプト（Bash）
- `test_client.py` - Pythonテストクライアント

## 🚀 使用方法

### 1. 自動テストスクリプト（推奨）

```bash
./test_mcp_server.sh
```

このスクリプトは以下のテストを自動実行します：
- サーバー初期化
- ツールリスト取得
- ツール実行
- エラーハンドリング
- 不正なJSONメッセージの処理

### 2. Pythonテストクライアント

```bash
python3 test_client.py
```

より詳細なテスト結果とエラー情報を提供します。非同期処理でサーバーと通信し、レスポンスをJSON形式で表示します。

### 3. インタラクティブテスト

```bash
./interactive_test.sh
```

手動でコマンドを選択してサーバーをテストできます：
- `1` または `init` - サーバー初期化
- `2` または `tools` - ツールリスト取得
- `3` または `call` - exampleTool実行
- `4` または `custom` - カスタムメッセージ送信
- `5` または `quit` - 終了

## 📋 テスト内容

### テストされる機能

1. **初期化プロセス**
   - `initialize` リクエスト
   - `notifications/initialized` 通知

2. **ツール機能**
   - `tools/list` - 利用可能なツールの一覧取得
   - `tools/call` - ツールの実行

3. **エラーハンドリング**
   - 存在しないツールの呼び出し
   - 不正なJSONメッセージの処理
   - パラメータエラーの処理

### 期待される結果

- **初期化**: サーバー情報とcapabilitiesが返される
- **ツールリスト**: `exampleTool`が含まれたリストが返される
- **ツール実行**: 入力メッセージが処理されて結果が返される
- **エラー**: 適切なJSON-RPCエラーレスポンスが返される

## 🔧 依存関係

テストスクリプトを実行する前に、以下がインストールされていることを確認してください：

```bash
# 必要なPythonパッケージ
pip install pydantic

# jqコマンド（Bashスクリプト用、オプション）
sudo apt-get install jq  # Ubuntu/Debian
# または
brew install jq  # macOS
```

## 🐛 トラブルシューティング

### よくある問題

1. **サーバーが起動しない**
   - Pythonパッケージが正しくインストールされているか確認
   - `python3 app.py` を直接実行してエラーメッセージを確認

2. **テストが失敗する**
   - サーバーログを確認（stderr出力）
   - ポートが使用中でないか確認

3. **レスポンスが返ってこない**
   - サーバープロセスが実行中か確認
   - 標準入出力の設定が正しいか確認

### デバッグモード

サーバーを直接実行してメッセージを手動で送信：

```bash
python3 app.py
```

その後、別のターミナルでJSONメッセージを送信：

```bash
echo '{"jsonrpc":"2.0","id":1,"method":"initialize","params":{"protocolVersion":"2024-11-05","capabilities":{},"clientInfo":{"name":"test","version":"1.0.0"}}}' | python3 app.py
```

## 📝 ログとデバッグ

テスト実行時は以下の情報が出力されます：
- 送信メッセージ（JSON形式）
- 受信レスポンス（JSON形式）
- エラーメッセージ
- サーバーのデバッグ情報（stderr）

この情報を使用してサーバーの動作を詳しく分析できます。
